#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include <string.h>
#include <locale.h>

/* ЗАДАНИЕ 12
Написать программу-календарь. Пользователь может указать даты в формате:
	- гггг.мм.дд - программа вычисляет день недели соответствующий данной дате;
	- гггг.мм - программа выводит календарь за данный месяц;
	- гггг - календарь за год;
	- now - текущую дату.
*/
int split(char str[], char **arr){
    char* token = strtok(str, ".");
    arr[0] = token;
    int i=0;

    while (token != NULL) {
        //printf(" % s\n", token);
        arr[i] = token; i++;
        token = strtok(NULL, ".");
    }
    return i;
}

int main() {
	setlocale(LC_ALL, "");
	char s[80];
	char *f;
	time_t t;
	struct tm *ltime = malloc(sizeof(struct tm));
	struct tm ttime;
	printf("Введите запрос: ");
	gets(s);
	char *sarr[5];
	switch (strlen(s)){
		case 10: // если введена полная дата
			if(s[4]=='.' && s[7]=='.'){
				split(s,sarr);
				ttime.tm_year = atoi(sarr[0])-1900;
				ttime.tm_mon = atoi(sarr[1])-1;
				ttime.tm_mday = atoi(sarr[2]);
//				t = time(NULL);
//				ltime=localtime(&t);
			//	printf("Текущяя дата: %s", asctime(&ttime));
			//	printf("Текущяя дата: %s", asctime(&ttime));
				
				//mktime(&ttime);
				f = "%A";
				strftime(s, 80, f, &ttime);
				printf("Текущяя дата: %s", asctime(&ttime));
				printf("День недели: %s", s);
			} else printf("Неизвестный запрос!\n");
			break;
		case 7: // если введены только год и месяц
			if(s[4]=='.'){
				split(s,sarr);
				ttime.tm_year = atoi(sarr[0])-1900;
				ttime.tm_mon = atoi(sarr[1])-1;
				ttime.tm_mday = 1;
				//mktime(&ttime);
				struct tm ktime = ttime;
				f = "%a | %d %b %Y";
				while (ktime.tm_mon == ttime.tm_mon){
					strftime(s, 80, f, &ktime);
					printf("%s\n", s);
					ktime.tm_mday = ktime.tm_mday + 1;
					mktime(&ktime);
				}
			} else printf("Неизвестный запрос!\n");
			break;
		case 4: // если введен только год
			split(s,sarr);
			ttime.tm_year = atoi(sarr[0])-1900;
			ttime.tm_mon = 0;
			ttime.tm_mday = 1;
			//mktime(&ttime);
			struct tm ktime = ttime;
			f = "%a | %d %b %Y";
			while (ktime.tm_year == ttime.tm_year){
				ttime = ktime;
				while (ktime.tm_mon == ttime.tm_mon){
					
					strftime(s, 80, f, &ktime);
					printf("%s\n", s);
					ktime.tm_mday = ktime.tm_mday + 1;
					mktime(&ktime);
				}
				ktime.tm_mday = 1;
				ktime.tm_mon++;
				mktime(&ktime);
			}
			break;
		case 3: // если введен now
			if (strcmp(s,"now")==0){
				t = time(NULL);
				ltime = localtime(&t);
				char f[10] = "%d %B %Y";
				strftime(s, 80, f, ltime);
				printf("Текущяя дата: %s", s);
			} else {
				printf("Неизвестный запрос!\n");
			}
			break;
	}
	
}
